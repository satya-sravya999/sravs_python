CREATE TABLE IF NOT EXISTS Salespeople (
    SNUM INT PRIMARY KEY,
    SNAME VARCHAR(50),
    CITY VARCHAR(50),
    COMM DECIMAL(4,2)
);

CREATE TABLE IF NOT EXISTS Customers (
    CNUM INT PRIMARY KEY,
    CNAME VARCHAR(50),
    CITY VARCHAR(50),
    RATING INT,
    SNUM INT,
    FOREIGN KEY (SNUM) REFERENCES Salespeople(SNUM)
);

CREATE TABLE IF NOT EXISTS Orders (
    ONUM INT PRIMARY KEY,
    AMT DECIMAL(10,2),
    ODATE DATE,
    CNUM INT,
    SNUM INT,
    FOREIGN KEY (CNUM) REFERENCES Customers(CNUM),
    FOREIGN KEY (SNUM) REFERENCES Salespeople(SNUM)
);

DELETE FROM Orders;
DELETE FROM Customers;
DELETE FROM Salespeople;

INSERT IGNORE INTO Salespeople (SNUM, SNAME, CITY, COMM) VALUES
(1001, 'Peel', 'London', 0.12),
(1002, 'Serres', 'San Jose', 0.13),
(1003, 'Axelrod', 'New York', 0.10),
(1004, 'Motika', 'London', 0.11),
(1007, 'Rafkin', 'Barcelona', 0.15);

INSERT IGNORE INTO Customers (CNUM, CNAME, CITY, RATING, SNUM) VALUES
(2001, 'Hoffman', 'London', 100, 1001),
(2002, 'Giovanne', 'Rome', 200, 1003),
(2003, 'Liu', 'San Jose', 300, 1002),
(2004, 'Grass', 'Berlin', 100, 1002),
(2006, 'Clemens', 'London', 300, 1007),
(2007, 'Pereira', 'Rome', 100, 1004);

INSERT IGNORE INTO Orders (ONUM, AMT, ODATE, CNUM, SNUM) VALUES
(3003, 767.19, '1994-10-03', 2001, 1001),
(3002, 1900.10, '1994-10-03', 2007, 1004),
(3005, 5160.45, '1994-10-03', 2003, 1002),
(3009, 1713.23, '1994-10-04', 2002, 1003),
(3007, 75.75, '1994-10-05', 2004, 1002),
(3008, 4723.00, '1994-10-05', 2006, 1001),
(3010, 1309.95, '1994-10-06', 2004, 1002),
(3011, 9891.88, '1994-10-06', 2006, 1001);

SELECT * FROM Salespeople;
SELECT * FROM Customers;
SELECT * FROM Orders;

SELECT SNUM, SNAME, CITY, COMM FROM Salespeople;

SELECT DISTINCT SNUM FROM Orders;

SELECT SNAME, COMM FROM Salespeople WHERE CITY = 'London';

SELECT * FROM Customers WHERE RATING = 100;

SELECT ONUM, AMT, ODATE FROM Orders;

SELECT * FROM Customers WHERE CITY = 'San Jose' AND RATING > 200;

SELECT * FROM Customers WHERE CITY = 'San Jose' OR RATING > 200;

SELECT * FROM Orders WHERE AMT > 1000;

SELECT SNAME, CITY FROM Salespeople WHERE CITY = 'London' AND COMM > 0.10;

SELECT * FROM Customers WHERE RATING > 100 OR CITY = 'Rome';

SELECT * FROM Salespeople WHERE CITY IN ('Barcelona', 'London');

SELECT * FROM Salespeople WHERE COMM > 0.10 AND COMM < 0.12;

SELECT * FROM Customers WHERE CITY IS NULL;

SELECT * FROM Orders WHERE ODATE IN ('1994-10-03', '1994-10-04');

SELECT * FROM Customers WHERE SNUM IN (1001, 1004);

SELECT * FROM Customers WHERE CNAME LIKE 'A%' OR CNAME LIKE 'B%';

SELECT * FROM Orders WHERE AMT IS NOT NULL AND AMT > 0;

SELECT COUNT(DISTINCT SNUM) AS Salespeople_Count FROM Orders;

SELECT SNUM, ODATE, MAX(AMT) AS Largest_Order FROM Orders GROUP BY SNUM, ODATE;

SELECT SNUM, MAX(AMT) AS Largest_Order FROM Orders WHERE AMT > 3000 GROUP BY SNUM;

SELECT ODATE, SUM(AMT) AS Total_Amount FROM Orders GROUP BY ODATE ORDER BY Total_Amount DESC LIMIT 1;

SELECT COUNT(*) AS Order_Count FROM Orders WHERE ODATE = '1994-10-03';

SELECT COUNT(DISTINCT CITY) AS Unique_Cities FROM Customers WHERE CITY IS NOT NULL;

SELECT CNUM, MIN(AMT) AS Smallest_Order FROM Orders GROUP BY CNUM;

SELECT * FROM Customers WHERE CNAME LIKE 'G%' ORDER BY CNAME ASC LIMIT 1;

SELECT DATE_FORMAT(ODATE, '%d/%m/%Y') AS Order_Date, COUNT(*) AS Order_Count 
FROM Orders GROUP BY ODATE;

SELECT ONUM, SNUM, AMT * 0.12 AS Commission FROM Orders;

SELECT CITY, MAX(RATING) AS Highest_Rating FROM Customers GROUP BY CITY;

SELECT ODATE, SUM(AMT) AS Total_Orders FROM Orders GROUP BY ODATE ORDER BY Total_Orders DESC;

SELECT S.SNAME AS Salesperson, C.CNAME AS Customer, S.CITY 
FROM Salespeople S JOIN Customers C ON S.CITY = C.CITY;

SELECT C.CNAME AS Customer, S.SNAME AS Salesperson
FROM Customers C
JOIN Salespeople S ON C.SNUM = S.SNUM;

SELECT O.ONUM AS OrderNo, C.CNAME AS Customer
FROM Orders O
JOIN Customers C ON O.CNUM = C.CNUM;

SELECT O.ONUM AS OrderNo, S.SNAME AS Salesperson, C.CNAME AS Customer
FROM Orders O
JOIN Salespeople S ON O.SNUM = S.SNUM
JOIN Customers C ON O.CNUM = C.CNUM;

SELECT C.*
FROM Customers C
JOIN Salespeople S ON C.SNUM = S.SNUM
WHERE S.COMM > 0.12;

SELECT O.ONUM, S.SNUM, (O.AMT * S.COMM) AS Commission
FROM Orders O
JOIN Customers C ON O.CNUM = C.CNUM
JOIN Salespeople S ON O.SNUM = S.SNUM
WHERE C.RATING > 100;

SELECT C1.CNAME AS Customer1, C2.CNAME AS Customer2, C1.RATING
FROM Customers C1, Customers C2
WHERE C1.RATING = C2.RATING AND C1.CNUM < C2.CNUM;

SELECT C1.CNAME AS Customer1, C2.CNAME AS Customer2, C1.RATING
FROM Customers C1
JOIN Customers C2 ON C1.RATING = C2.RATING
WHERE C1.CNUM < C2.CNUM;

SET @limit_value = (SELECT COUNT(*) FROM Customers) * 3;
SELECT C.CNAME, S.SNAME
FROM Customers C
CROSS JOIN Salespeople S
LIMIT @limit_value;

SELECT DISTINCT C.*
FROM Customers C
WHERE C.CITY IN (SELECT CITY FROM Customers WHERE SNUM = 1002);

SELECT C1.CNAME AS Customer1, C2.CNAME AS Customer2, C1.SNUM
FROM Customers C1
JOIN Customers C2 ON C1.SNUM = C2.SNUM
WHERE C1.CNUM < C2.CNUM;

SELECT S1.SNAME AS Salesperson1, S2.SNAME AS Salesperson2, S1.CITY
FROM Salespeople S1
JOIN Salespeople S2 ON S1.CITY = S2.CITY
WHERE S1.SNUM < S2.SNUM;

SELECT O1.ONUM AS Order1, O2.ONUM AS Order2, O1.CNUM
FROM Orders O1
JOIN Orders O2 ON O1.CNUM = O2.CNUM
WHERE O1.ONUM < O2.ONUM;

SELECT C.CNAME, C.CITY
FROM Customers C
WHERE C.RATING = (SELECT RATING FROM Customers WHERE CNAME = 'Hoffman');

SELECT * FROM Orders WHERE SNUM = (SELECT SNUM FROM Salespeople WHERE SNAME = 'Motika');

SELECT * FROM Orders WHERE SNUM = (SELECT SNUM FROM Customers WHERE CNAME = 'Hoffman');

SELECT * FROM Orders 
WHERE AMT > (SELECT AVG(AMT) FROM Orders WHERE ODATE = '1994-10-04');

SELECT AVG(COMM) AS Avg_Commission FROM Salespeople WHERE CITY = 'London';

SELECT * FROM Orders
WHERE SNUM IN (SELECT SNUM FROM Customers WHERE CITY = 'London');

SELECT S.SNUM, S.SNAME, S.COMM
FROM Salespeople S
WHERE S.SNUM IN (SELECT DISTINCT SNUM FROM Customers WHERE CITY = 'London');

SELECT * FROM Customers
WHERE CNUM = (SELECT SNUM + 1000 FROM Salespeople WHERE SNAME = 'Serres');

SELECT COUNT(*) AS Customer_Count 
FROM Customers 
WHERE RATING > (SELECT AVG(RATING) FROM Customers WHERE CITY = 'San Jose');

SELECT * FROM Orders 
WHERE CNUM = (SELECT CNUM FROM Customers WHERE CNAME = 'Cisnerous');

SELECT C.CNAME, C.RATING
FROM Customers C
WHERE C.CNUM IN (SELECT CNUM FROM Orders WHERE AMT > (SELECT AVG(AMT) FROM Orders));

SELECT SNUM, SUM(AMT) AS Total_Sales
FROM Orders
GROUP BY SNUM
HAVING Total_Sales > (SELECT MAX(AMT) FROM Orders);

SELECT DISTINCT C.*
FROM Customers C
JOIN Orders O ON C.CNUM = O.CNUM
WHERE O.ODATE = '1994-10-03';

SELECT S.SNUM, S.SNAME, COUNT(C.CNUM) AS Customer_Count
FROM Salespeople S
JOIN Customers C ON S.SNUM = C.SNUM
GROUP BY S.SNUM, S.SNAME
HAVING COUNT(C.CNUM) > 1;

SELECT O.ONUM, O.SNUM, C.SNUM AS Correct_SNUM
FROM Orders O
JOIN Customers C ON O.CNUM = C.CNUM
WHERE O.SNUM <> C.SNUM;

SELECT * FROM Orders O
WHERE AMT > (SELECT AVG(AMT) FROM Orders WHERE CNUM = O.CNUM);

SELECT ODATE, SUM(AMT) AS Total_Amount
FROM Orders
GROUP BY ODATE
HAVING Total_Amount >= (SELECT MAX(AMT) + 2000 FROM Orders);

SELECT CNUM, CNAME, CITY, RATING
FROM Customers C1
WHERE RATING = (SELECT MAX(RATING) FROM Customers C2 WHERE C1.CITY = C2.CITY);

SELECT DISTINCT S.SNUM, S.SNAME, S.CITY
FROM Salespeople S
JOIN Customers C ON S.CITY = C.CITY
WHERE S.SNUM <> C.SNUM;

SELECT * FROM Salespeople S
WHERE EXISTS (
    SELECT 1 FROM Customers C
    WHERE S.CITY = C.CITY AND S.SNUM <> C.SNUM
);

SELECT CNUM, CNAME, CITY 
FROM Customers 
WHERE EXISTS (SELECT 1 FROM Customers WHERE CITY = 'San Jose');

SELECT SNUM 
FROM Customers 
GROUP BY SNUM 
HAVING COUNT(CNUM) > 1;

SELECT S.SNUM, S.SNAME, S.CITY
FROM Salespeople S
WHERE S.SNUM IN (SELECT SNUM FROM Customers GROUP BY SNUM HAVING COUNT(CNUM) > 1);

SELECT SNUM 
FROM Customers 
GROUP BY SNUM 
HAVING COUNT(CNUM) = 1;

SELECT SNUM 
FROM Orders 
GROUP BY SNUM 
HAVING COUNT(ONUM) > 1;

SELECT * FROM Salespeople S
WHERE EXISTS (SELECT 1 FROM Customers C WHERE C.RATING = 300 AND S.SNUM = C.SNUM);

SELECT DISTINCT S.*
FROM Salespeople S
JOIN Customers C ON S.SNUM = C.SNUM
WHERE C.RATING = 300;

SELECT * FROM Salespeople S
WHERE EXISTS (
    SELECT 1 FROM Customers C
    WHERE S.CITY = C.CITY AND S.SNUM <> C.SNUM
);

SELECT DISTINCT C.*
FROM Customers C
WHERE C.SNUM IN (
    SELECT C1.SNUM
    FROM Customers C1
    JOIN Orders O ON C1.CNUM = O.CNUM
    GROUP BY C1.SNUM
    HAVING COUNT(DISTINCT C1.CNUM) > 1
);

SELECT * FROM Salespeople S
WHERE S.CITY = ANY (SELECT CITY FROM Customers);

SELECT * FROM Salespeople S
WHERE S.CITY IN (SELECT CITY FROM Customers);

SELECT * FROM Salespeople S
WHERE S.SNAME < ANY (SELECT CNAME FROM Customers);

SELECT * FROM Salespeople S
WHERE EXISTS (
    SELECT 1 FROM Customers C WHERE C.CNAME > S.SNAME
);

SELECT * FROM Customers C
WHERE C.RATING > ANY (SELECT RATING FROM Customers WHERE CITY = 'Rome');

SELECT * FROM Orders
WHERE AMT > ANY (SELECT AMT FROM Orders WHERE ODATE = '1994-10-06');

SELECT * FROM Orders
WHERE AMT < ANY (SELECT AMT FROM Orders O JOIN Customers C ON O.CNUM = C.CNUM WHERE C.CITY = 'San Jose');

SELECT * FROM Orders
WHERE AMT < (SELECT MIN(AMT) FROM Orders O JOIN Customers C ON O.CNUM = C.CNUM WHERE C.CITY = 'San Jose');

SELECT * FROM Customers
WHERE RATING > ALL (SELECT RATING FROM Customers WHERE CITY = 'Paris');

SELECT * FROM Customers C1
WHERE NOT EXISTS (
    SELECT 1 FROM Customers C2 WHERE C2.CITY = 'Paris' AND C1.RATING <= C2.RATING
);

SELECT * FROM Customers
WHERE RATING >= ANY (SELECT RATING FROM Customers WHERE SNUM = (SELECT SNUM FROM Salespeople WHERE SNAME = 'Serres'));

SELECT * FROM Salespeople S
WHERE S.CITY <> ANY (SELECT CITY FROM Customers);

SELECT * FROM Salespeople S
WHERE S.CITY <> ALL (SELECT CITY FROM Customers);

SELECT * FROM Orders
WHERE AMT > ANY (SELECT AMT FROM Orders O JOIN Customers C ON O.CNUM = C.CNUM WHERE C.CITY = 'London');

SELECT 'Salesperson' AS Type, SNAME AS Name, CITY FROM Salespeople WHERE CITY = 'London'
UNION
SELECT 'Customer', CNAME, CITY FROM Customers WHERE CITY = 'London';

SELECT SNUM, 
       (SELECT ODATE FROM Orders O WHERE O.SNUM = S.SNUM ORDER BY AMT DESC LIMIT 1) AS Highest_Order_Date,
       (SELECT ODATE FROM Orders O WHERE O.SNUM = S.SNUM ORDER BY AMT ASC LIMIT 1) AS Lowest_Order_Date
FROM Salespeople S;

SELECT S.SNUM, S.SNAME, S.CITY, 
       CASE WHEN EXISTS (SELECT 1 FROM Customers C WHERE C.CITY = S.CITY) 
       THEN 'Has Customers' ELSE 'No Customers' END AS Customer_Status
FROM Salespeople S;

SELECT S.SNUM, S.SNAME, S.CITY,
       CONCAT(S.SNAME, ' - ', 
              CASE WHEN EXISTS (SELECT 1 FROM Customers C WHERE C.CITY = S.CITY) 
                   THEN 'Matched to a Customer' 
                   ELSE 'No Match' END) AS Match_Status
FROM Salespeople S;

SELECT CNAME, CITY, RATING, 'High Rating' AS Rating_Status FROM Customers WHERE RATING >= 200
UNION
SELECT CNAME, CITY, RATING, 'Low Rating' FROM Customers WHERE RATING < 200;

SELECT SNUM AS Number, SNAME AS Name FROM Salespeople
UNION
SELECT CNUM, CNAME FROM Customers WHERE CNUM IN (SELECT CNUM FROM Orders GROUP BY CNUM HAVING COUNT(ONUM) > 1)
ORDER BY Name;

SELECT SNUM AS ID FROM Salespeople WHERE CITY = 'San Jose'
UNION 
SELECT CNUM FROM Customers WHERE CITY = 'San Jose'
UNION ALL
SELECT ONUM FROM Orders WHERE ODATE = '1994-10-03';

SELECT DISTINCT S.* FROM Salespeople S
JOIN Customers C ON S.SNUM = C.SNUM
WHERE S.CITY = 'London' AND C.CITY = 'London';

SELECT * FROM Salespeople 
WHERE CITY = 'London' 
AND SNUM NOT IN (SELECT SNUM FROM Customers WHERE CITY = 'London');
